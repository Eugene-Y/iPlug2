#Download and unzip secure files for VST2_SDK, AAX_SDK and AGG
steps:
  - task: DownloadSecureFile@1
    inputs:
      secureFile: "VST2_SDK.zip"
    displayName: Download VST2 SDK
    condition: or(variables.build_mac, variables.build_win)

  - task: DownloadSecureFile@1
    inputs:
      secureFile: "AAX_SDK.zip"
    displayName: Download AAX SDK
    condition: or(variables.build_mac, variables.build_win)

  - task: DownloadSecureFile@1
    inputs:
      secureFile: "AGG.zip"
    displayName: Download AGG
    condition: or(variables.build_mac, variables.build_win)

  - task: ExtractFiles@1
    inputs:
      archiveFilePatterns: '$(Agent.TempDirectory)/VST2_SDK.zip'
      destinationFolder: '$(Agent.TempDirectory)'
      cleanDestinationFolder: false

  - task: ExtractFiles@1
    inputs:
      archiveFilePatterns: '$(Agent.TempDirectory)/AAX_SDK.zip'
      destinationFolder: '$(Agent.TempDirectory)'
      cleanDestinationFolder: false

  - task: ExtractFiles@1
    inputs:
      archiveFilePatterns: '$(Agent.TempDirectory)/AGG.zip'
      destinationFolder: '$(Agent.TempDirectory)'
      cleanDestinationFolder: false

  - bash: |
      mv $AGENT_TEMPDIRECTORY/AAX_SDK/* ./Dependencies/IPlug/AAX_SDK
      mv $AGENT_TEMPDIRECTORY/VST2_SDK/* ./Dependencies/IPlug/VST2_SDK
      mkdir ./Dependencies/IGraphics/AGG
      mv $AGENT_TEMPDIRECTORY/AGG/* ./Dependencies/IGraphics/AGG
      rm $AGENT_TEMPDIRECTORY/*.zip
    displayName: Move Secure File Dependencies
    condition: and(or(variables.build_mac, variables.build_win), eq(variables.build_deps, false))